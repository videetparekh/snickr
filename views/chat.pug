extends layout

block variables
  - var title = "Chat"

block content
  h2.text-center #{channelDetails[0].cname}
  if (user.id == channelDetails[0].ccreatorid && (channelDetails[0].ctype == "direct" || channelDetails[0].ctype == "private"))
      h4 Invite User to Channel
      div.dashboard-form 
          form(method='POST' action='/chat/sendinvite/?channel='+channelDetails[0].cid)
            div.form-group
              label(for='user_email') User Email:
              input#user_email.form-control(type='email', name='user_email', placeholder="Enter user email")
            input(type='submit', value='Invite User to Channel')      

          
  p
    div.chat-container#chatwindow
      for msg in messageList
        div.message-box
          p.headline
            strong  #{msg.name}:
          p
            | #{msg.content}
    .formcontainer
        p
            form#send-message()
              div.form-group
                label(for='message') Chat:
                input#message.form-control(type='text', name='message')
    script.
      $('#send-message').on('submit',function (e) {
          e.preventDefault();
              $.ajax({
                type: 'post',
                url: '/chat/sendMessage/?channel='+ #{channelDetails[0].cid},
                data: $('#send-message').serialize(),
                success: function (result) {
                 console.log("message has been sent!");
                 document.getElementById("send-message").reset();
                 autoRefresh_div();

                var scrollingElement = (document.scrollingElement || document.body);
                scrollingElement.scrollTop = scrollingElement.scrollHeight;

                }
              });
        });

    script.
      function autoRefresh_div() {
        $("#chatwindow").load("/chat/load", {'cid': #{channelDetails[0].cid} });
        const messages = document.getElementById('chatwindow');
        console.log(message.scrollTop)
        message.scrollTop = message.clientHeight;
      }
      setInterval(autoRefresh_div, 1000);
    
    style.
      .message-box{
        border-radius: 5px;
        padding: 2px;
        margin-bottom:2px;
      }
      .headline{
        margin-bottom:2px;
        font-size:18px
      }
      #chatwindow{
        overflow-y: auto;
      }
      .formcontainer {
        position:fixed;
        left:0px;
        bottom:0px;
        height:80px;
        width:100%;
      }
